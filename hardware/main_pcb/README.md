# main pcb:

<br /><br />

## The main pcb contains all the circuitry for the effect, excluding the 1/4" jacks, 9vdc power entry jack, and true-bypass footswitch. These off-board components are connected to the main pcb with soldered flying wires. 

<br /><br />

---

## Description of the audio circuit:

The audio signal is immediately buffered by a FET source-follower which provides a high impedance input as expected by guitars and other musical instruments.

The signal is then compressed by 1/2 of an NE570 compandor chip configured as a compressor. This compression squishes the audio signal into a reduced range so that both quiet and loud signals take up enough ADC resolution for the algorithm to work with.

The compressed audio signal is then sent to a variable gain amplifier where the user can adjust the magnitude of the signal entering the ADC to taste. This amplifier also acts as a clipping amplifier to protect the ADC from signals outside of its voltage range. A bi-color LED acts as a signal strength and clipping indicator as an aid to the user in setting a healthy signal level.

Now the signal is read in to the microcontroller by an onboard ADC and processed internally.

The processed digitized signal is then converted back to an analog signal by the microcontrollers onboard DAC.

The output of the DAC is fed into an opamp low pass filter to attenuate very high frequencies outside of the audio band.

The filtered processed signal is finally sent to the other half of the NE570 configured as an expandor this time. This restores the dynamic range of the original audio signal.

<br /><br />

---

## Description of the control circuit:

Control voltage signals for bit-depth and sample-rate are generated by opamps. The contribution of onboard rotary potentiometers and optional external control voltage signals are summed and inverted.

The opamp control voltage generators also act as protection for the ADC. Control voltages outside of the safe range for the ADC will be harmlessly clipped by the opamps.

These control voltage signals are then read in to the microcontroller by onboard ADCs and used to process the audio signals.

The external CV input ports can accept either voltage signals in the range of 0 volts to +5 volts, or they can accept an expression pedal connected to a TRS jack.

Because different brands of expression pedals use different potentiometer values, trim-pots are included to calibrate the device for various expression pedals.

<br /><br />

---

## Errata:

A port for an optional on/off LED indicator is included on the main pcb. If desired attach a panel mounted LED to this port through a spare pole of a bypass switch.

An SWD header is used to program and debug the STM32 microcontroller.

This project is intended as a "guitar pedal" type effects box which fits in a Hammond 'BB' style enclosure. The main pcb is affixed to the enclosure with the pcb mounted potentiometers. Flying wires are then routed to the chassis mounted 1/4" jacks, 9vdc power input jack, and true-bypass footswitch.

There are optional mounting holes if a different mechanical setup is desired.

<br /><br />

---

## Top and bottom render of the main pcb:

<br /><br />
![](./pics/pcb_rear.png?raw=true "main pcb")

![](./pics/pcb_front.png?raw=true "main pcb")
